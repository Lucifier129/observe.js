/* observe.js 2014-12-22 */
(function(t,n){function e(t){return function(){return Function.prototype.call.apply(t,arguments)}}function r(t){return function(n){return null==n?n:h(n)==="[object "+t+"]"}}function i(e,r,i){if(e==n||!g(r))return e;var o,f=e.length,u=0;if(f===+f&&f>0){for(;f>u;u+=1)if(o=r.call(i||t,e[u],u),o!==n)return o;return e}var s,c=y.keys(e);for(f=c.length;f>u;u+=1)if(s=c[u],o=r.call(i||t,e[s],s),o!==n)return o;return e}function o(){var t,n=arguments[0];if("boolean"==typeof n&&(t=n,n=arguments[1]),"object"!=typeof n&&!g(n))return n;var e=v(arguments,t?2:1);return i(e,function(e){"object"==typeof e&&i(e,function(e,r){if(t&&"object"==typeof e){var i=n[r];return n[r]="object"==typeof i?i:{},o(t,n[r],e)}n[r]=e})}),n}function f(t){return t+Math.random().toString(36).substr(2)}function u(t){return setTimeout(t,0)}function s(t){var n;return p(t)?n=o(!0,{},t):d(t)?(n=[],i(t,function(t,e){n[e]=s(t)})):n=t,n}function c(t){o(this,t)}function _(t,n){if(!p(t))return t;var e=o(new c(t),{__events__:{}});return p(n)||g(n)?e.on(n):e}var a=Object.prototype,h=e(a.toString),l=e(a.hasOwnProperty),v=e(Array.prototype.slice),p=r("Object"),b=r("String"),g=r("Function"),d=Array.isArray||r("Array"),y={keys:Object.keys||function(t){var n=[];if(!p(t))return n;for(var e in t)l(t,e)&&n.push(e);return n}};Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var n=this.length-1;n>=0;n--)if(this[n]===t)return n;return-1});var j=function(t,n,e,r){if(t===n)return 0!==t||1/t===1/n;if(null==t||null==n)return t===n;var i=h(t);if(i!==h(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!==+t?+n!==+n:0===+t?1/+t===1/n:+t===+n;case"[object Date]":case"[object Boolean]":return+t===+n}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof n)return!1;var f=t.constructor,u=n.constructor;if(f!==u&&!(g(f)&&f instanceof f&&g(u)&&u instanceof u)&&"constructor"in t&&"constructor"in n)return!1}for(var s=e.length;s--;)if(e[s]===t)return r[s]===n;e.push(t),r.push(n);var c,_;if(o){if(c=t.length,_=c===n.length)for(;c--&&(_=j(t[c],n[c],e,r)););}else{var a,v=y.keys(t);if(c=v.length,_=y.keys(n).length===c)for(;c--&&(a=v[c],_=l(n,a)&&j(t[a],n[a],e,r)););}return e.pop(),r.pop(),_};y.isEqual=function(t,n){return j(t,n,[],[])};var O,m=/\[native code\]/;if(m.test(Object.defineProperty)&&m.test(Object.create)?O=Object.defineProperty:m.test(Object.prototype.__defineSetter__)&&(O=function(t,n,e){t.__defineGetter__(n,e.get),t.__defineSetter__(n,e.set)}),!O)throw Error("Object.defineProperty is undefined");var x=function(t,n){function e(){i(t.__events__[n],function(e){i(e,function(e){e.call(t,o,n,f)})}),f=s(o),r=!1}if(!(n in t.__events__)){var r,o=t[n],f=s(o);O(t,n,{get:function(){return o},set:function(t){o=t,r||y.isEqual(t,f)||(r=!0,u(e))}})}},A={_add:function(t,n,e){x(this,t),e=e||f("observer");var r=this.__events__[t]=this.__events__[t]||{};return r[e]=r[e]||[],r[e].push(n),this},on:function(){var t,n=this,e=v(arguments),r=e.length;if(1===r)p(t=e[0])?i(t,function(t,e){n.on(e,t)}):g(t)&&this.each(function(e,r){n._add(r,t,"__all__")});else if(2===r){if(!g(e[1]))return this;if(b(t=e[0])){var o=t.indexOf(".");0>=o?this._add(t,e[1]):this._add(t.substr(0,o),e[1],t.substr(o+1))}else d(t)&&i(t,function(t){n.on(t,e[1])})}return this},_bang:function(t,n,e){var r=this,o=r[t];i(this.__events__[t][e],function(e){e.call(r,n,t,o)})},trigger:function(t,n){var e,r=this;return t?(b(t)?(e=t.indexOf("."),e>0?this._bang(t.substr(0,e),n,t.substr(e+1)):e?i(this.__events__[t]||[],function(e,i){r._bang(t,n,i)}):(t=t.substr(1),i(this.__events__,function(e,o){i(e,function(e,i){i===t&&r._bang(o,n,i)})}))):d(t)&&i(t,function(t){r.trigger(t,n)}),this):this},_remove:function(t,n,e){var r=this.__events__[t][e]||[],i=r.indexOf(n);return-1!==i&&r.splice(i,1),this},off:function(){var t,n,e=this,r=v(arguments),o=r.length;if(o){if(1===o)g(t=r[0])?i(this.__events__,function(n,r){i(n,function(n,i){e._remove(r,t,i)})}):b(t)&&(n=t.indexOf("."),0>=n?this.__events__[t]={}:delete this.__events__[t.substr(0,n)][t.substr(n+1)]);else if(2===o){if(!g(r[1]))return this.off(r[0]),this;b(t=r[0])?(n=t.indexOf("."),0>=n?i(this.__events__[t],function(n,i){e._remove(t,r[1],i)}):this._remove(t.substr(0,n),r[1],t.substr(n+1))):d(t)&&i(t,function(t){e.off(t,r[1])})}}else this.__events__={};return this},offAll:function(){var t=this;return i(this.__events__,function(n,e){t.off([e,"__all__"].join("."))}),this},each:function(t){var n=this;return i(this,function(e,r){-1===n.filter.indexOf(r)&&t.call(n,e,r)}),this},extend:function(){return o.apply(t,[this].concat(v(arguments)))},once:function(t,n){function e(){n.apply(r,arguments),r.off(e)}var r=this;return t+=".once",this.on(t,e)},tie:function(t,n){if(!g(n))return this;if(d(t)){var e=this,r=t.length,o=[],f=[],u=function(u,s){0>o.indexOf(s)?(o.push(s),o.length===r&&(i(t,function(t,n){t=t.split(".")[0],f[n]=e[t]}),n.apply(e,f))):o.length>=r&&(o.length=0,o.push(s))};return this.on(t,u)}return b(t)?(t=t.split(" "),t.length>1?this.tie(t,n):this.on(t[0],n)):this},collect:function(t,n,e){function r(t){o.push(t),o.length===n&&(e.apply(i,o),i.off(r))}var i=this,o=[];return this.on(t,r)}};A.bind=A.on,A.unbind=A.off,A.fire=A.trigger,A.filter=y.keys(A).concat(["__events__","filter"]),c.prototype=A,_.fn=A,"function"==typeof define&&(define.amd||define.cmd)?define(function(){return _}):t.observe=_})(this);